{extend name="common:main" /}
{block name="cssjs"}
<script src="__PUBLIC__/static/js/admin/tool_check.js?{$Think.config.html_v}"></script>
{/block}
{block name="content"}
<div class="box box-default">
	<div class="box-body">
		<form id="form_check" action="{:url('tool/checkdb')}" method="post" style="text-align:center;padding:50px 0;">
       	{:html_usertoken()}	
       		<input type="hidden" name="sub" value="1" />
       		<h1>校验数据库一致性</h1>
       		<p class="lead">数据库不一致可能导致程序运行错误、功能缺失、系统紊乱等</p>
       		<p><button type="submit" class="btn btn-lg btn-success">开始校验</button></p>
		</form>
		<div id="error_box" style="display:none;">
			<div id="error_engines" style="display:none;">
			<h3>请检查您数据库中的存储引擎是否与以下存储引擎一致</h3>
			<table class="table table-bordered">
			<thead>
				<tr>
					<th style="width:100px;">表名</th>
					<th>存储引擎</th>
				</tr>
			</thead>
			<tbody>
				
			</tbody>
			</table>
			</div>
			<div id="error_fields" style="display:none;">
			<h3>请检查您数据库中的字段是否与以下字段一致</h3>
			<table class="table table-bordered">
			<thead>
				<tr>
					<th>表名</th>
					<th>字段名</th>
					<th>数据类型</th>
					<th>默认值</th>
					<th>主键？</th>
					<th>非空？</th>
					<th>自增？</th>
				</tr>
			</thead>
			<tbody>
				
			</tbody>
			</table>
			</div>
			<div id="error_indexes" style="display:none;">
			<h3>请检查您数据库中的索引是否与以下索引一致</h3>
			<table class="table table-bordered">
			<thead>
				<tr>
					<th>表名</th>
					<th>索引名</th>
					<th>索引字段</th>
					<th>索引类型</th>
				</tr>
			</thead>
			<tbody>
			
			</tbody>
			</table>
			</div>
			<div class="alert alert-warning" id="error_error_tables" style="display:none;"></div>
			<button class="btn btn-lg btn-primary" id="repair_db">一键修复数据库</button>
			<div class="alert alert-warning" id="error_info" style="margin-top:20px;margin-bottom:0;display:none;"></div>
		</div>
	</div>
</div>

<script type="text/javascript">
toolCheckDb();
</script>
{/block}